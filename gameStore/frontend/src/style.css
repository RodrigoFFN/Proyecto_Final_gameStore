<template>
  <b-container class="py-5">
    <b-row>
      <b-col>
        <h1 class="text-center text-info fw-bold mb-4" style="text-shadow: 2px 2px #000;">
          ðŸŽ® Bienvenido a <span class="text-primary">ESGames</span>
        </h1>
        <div v-if="isAuthenticated" class="mb-4 h5 text-center">
          Â¡Hola de nuevo, <span class="text-danger fw-semibold">{{ userName }}</span>!
        </div>
      </b-col>
    </b-row>

    <b-row class="justify-content-center mb-5">
      <b-col md="6">
        <b-form-group label="Filtrar por categorÃ­a" label-for="category-select">
          <b-form-select
            id="category-select"
            v-model="selectedCategory"
            :options="categoryOptions"
            class="form-select border-info text-light bg-dark"
          ></b-form-select>
        </b-form-group>
      </b-col>
    </b-row>

    <b-row>
      <b-col>
        <h2 class="text-secondary text-center mb-4" style="font-family: 'Press Start 2P', monospace;">ðŸŽ² Juegos disponibles</h2>
        <div v-if="loading" class="text-warning text-center">Cargando videojuegos...</div>
        <div v-else-if="filteredGames.length === 0" class="text-danger text-center">No se encontraron videojuegos.</div>
      </b-col>
    </b-row>

    <b-row>
      <b-col
        v-for="game in filteredGames"
        :key="game.id"
        cols="12"
        sm="6"
        md="4"
        lg="3"
        class="mb-5"
      >
        <b-card
          :title="game.title"
          :img-src="game.image_url"
          img-alt="Game image"
          img-top
          class="h-100 text-light border border-info bg-dark shadow-lg"
        >
          <b-card-text class="text-muted small">
            {{ game.description }}
          </b-card-text>

          <p><strong>ðŸ’µ Precio:</strong> ${{ game.price }}</p>
          <p><strong>ðŸ“‚ CategorÃ­a:</strong> {{ game.category?.name }}</p>
          <p><strong>ðŸ“… Lanzamiento:</strong> {{ formatDate(game.release_date) }}</p>

          <router-link :to="`/game/${game.id}`" class="btn btn-link text-info p-0">
            Detalles
          </router-link>

          <div class="mt-3 d-grid gap-2">
            <b-button
              v-if="isAuthenticated && !isInCart(game.id) && !isPurchased(game.id)"
              variant="primary"
              class="fw-bold"
              @click="addToCart(game.id)"
            >
              AÃ±adir al carrito
            </b-button>

            <b-alert
              v-else-if="isAuthenticated && isPurchased(game.id)"
              variant="success"
              show
              class="p-2 text-center"
            >
              âœ… Ya en tu biblioteca
            </b-alert>

            <b-alert
              v-else-if="isAuthenticated && isInCart(game.id)"
              variant="warning"
              show
              class="p-2 text-center"
            >
              ðŸ›’ Ya en tu carrito
            </b-alert>

            <b-button
              v-if="isAuthenticated"
              :variant="isFavorite(game.id) ? 'danger' : 'outline-danger'"
              @click="toggleFavorite(game)"
              class="fw-semibold"
            >
              {{ isFavorite(game.id) ? 'Quitar de Favoritos' : 'AÃ±adir a Favoritos' }}
            </b-button>
          </div>
        </b-card>
      </b-col>
    </b-row>
  </b-container>
</template>
